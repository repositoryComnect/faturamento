<!-- Modal de Desvinculação de Planos de um Contrato -->
<div class="modal fade" id="desvincularPlanoContractModal" tabindex="-1" aria-labelledby="desvincularPlanoContractModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <form method="POST" action="{{ url_for('contratos_bp.desvincular_planos') }}">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="desvincularPlanoContractModalLabel">Desvincular Plano(s) do Contrato</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
  
            <!-- Seletor de contrato -->
            <div class="mb-3">
              <label for="desvincular_contrato_id_planos" class="form-label">Selecione um Contrato:</label>
              <select class="form-select" name="contrato_id" id="desvincular_contrato_id_planos" required>
              </select>
            </div>
  
            <!-- Seletor múltiplo de planos vinculados -->
            <div class="mb-3">
              <label for="planos_vinculados" class="form-label">Planos Vinculados:</label>
              <select class="form-select" name="planos_ids" id="planos_vinculados" multiple required size="10">
              </select>
            </div>
  
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-danger">Desvincular</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const contratoSelect = document.getElementById("desvincular_contrato_id_planos");
      const planoSelect = document.getElementById("planos_vinculados");
      const modal = document.getElementById('desvincularPlanoContractModal');
  
      // Carrega contratos ao abrir o modal
      modal.addEventListener('show.bs.modal', function () {
        fetch("/contratos_ativos")
          .then(response => response.json())
          .then(data => {
            contratoSelect.innerHTML = "<option disabled selected value=''>Selecione um contrato</option>";
            data.forEach(contrato => {
              const option = document.createElement("option");
              option.value = contrato.id;
              option.text = `${contrato.numero} - ${contrato.razao_social}`;
              contratoSelect.appendChild(option);
            });
          })
          .catch(error => {
            console.error("Erro ao carregar contratos:", error);
          });
      });
  
      // Carrega planos vinculados ao selecionar contrato
      contratoSelect.addEventListener("change", function () {
        const contratoId = this.value;
  
        if (!contratoId) return;
  
        fetch(`/get/planos_por_contrato/${contratoId}`)
          .then(response => response.json())
          .then(data => {
            planoSelect.innerHTML = "";
            if (data.length === 0) {
              const option = document.createElement("option");
              option.disabled = true;
              option.text = "Nenhum plano vinculado.";
              planoSelect.appendChild(option);
            } else {
              data.forEach(plano => {
                const option = document.createElement("option");
                option.value = plano.id;
                option.text = `${plano.nome} - R$ ${plano.valor}`;
                planoSelect.appendChild(option);
              });
            }
          })
          .catch(error => {
            console.error("Erro ao carregar planos vinculados:", error);
          });
      });
    });
  </script>
  
  
    