<!-- Script: carrega clientes e preenche nome no campo 'numero_serie' -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const select = document.getElementById('cliente_selecionado');
        const numeroSerieInput = document.getElementById('company') || document.getElementById('razao_social');
;

        fetch('/get/list/clientes')
            .then(response => response.json())
            .then(data => {
                select.innerHTML = '<option value="">Vincule um cliente</option>';
                data.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id;  // será cliente_id no backend
                    option.textContent = cliente.razao_social;
                    option.setAttribute('data-nome', cliente.razao_social);  // usado para preencher número de série
                    select.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Erro ao buscar clientes:', error);
                select.innerHTML = '<option value="">Erro ao carregar clientes</option>';
            });

        select.addEventListener('change', function () {
            const nome = select.options[select.selectedIndex].getAttribute('data-nome');
            numeroSerieInput.value = nome || '';
        });
    });
</script>

<!-- Script: define data atual no campo 'cadastramento' -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const hoje = new Date();
        const dia = String(hoje.getDate()).padStart(2, '0');
        const mes = String(hoje.getMonth() + 1).padStart(2, '0');
        const ano = hoje.getFullYear();
        const dataFormatada = `${ano}-${mes}-${dia}`;  // formato compatível com MySQL

        const campo = document.getElementById('cadastramento', 'registry');
        if (campo && !campo.value) {
            campo.value = dataFormatada;
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        fetch('/proximo_codigo_instalacao')
            .then(response => response.json())
            .then(data => {
                const campoCodigo = document.getElementById('codigo_instalacao');
                if (campoCodigo && data.proximo_codigo_instalacao) {
                    campoCodigo.value = data.proximo_codigo_instalacao;
                }
            })
            .catch(error => {
                console.error('Erro ao buscar próximo código de instalação:', error);
            });
    });
    </script>
    