<script>

    function toggleCollapse(id) {
        const collapse = document.getElementById(id);
        const icon = collapse.previousElementSibling.querySelector('i');
        
        collapse.classList.toggle('show');
        
        if (collapse.classList.contains('show')) {
            icon.classList.remove('bi-chevron-up');
            icon.classList.add('bi-chevron-down');
        } else {
            icon.classList.remove('bi-chevron-down');
            icon.classList.add('bi-chevron-up');
        }
    }
    
    function confirmarExclusao(planoId) {
        if (confirm('Tem certeza que deseja excluir este plano?')) {
            window.location.href = '/planos/excluir/' + planoId;
        }
    }
</script>



<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch("/contratos_ativos")
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById("contrato_id");
                select.innerHTML = '<option value="">Selecione um contrato</option>';
                const planoContratoId = "{{ plano.contrato_id or '' }}";
    
                data.forEach(contrato => {
                    const option = document.createElement("option");
                    option.value = contrato.id;
                    option.text = `${contrato.numero} - ${contrato.razao_social}`;
                    if (planoContratoId && planoContratoId == contrato.id.toString()) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            })
            .catch(error => {
                console.error("Erro ao carregar contratos:", error);
                const select = document.getElementById("contrato_id");
                select.innerHTML = '<option value="">Erro ao carregar contratos</option>';
            });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch("/planos/get_produtos", {
            method: "POST"
        })
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById("produto_id");
                select.innerHTML = '<option value="">Selecione um produto</option>';
                const planoProdutoId = "{{ plano.produto_id or '' }}";

                data.forEach(produto => {
                    const option = document.createElement("option");
                    option.value = produto.id;
                    option.text = `${produto.codigo} - ${produto.nome} - ${produto.preco_base} R$`; // <-- Ajustado aqui
                    if (planoProdutoId && planoProdutoId == produto.id.toString()) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            })
            .catch(error => {
                console.error("Erro ao carregar produtos:", error);
                const select = document.getElementById("produto_id");
                select.innerHTML = '<option value="">Erro ao carregar contratos</option>';
            });
    });
</script>

<script>
        document.addEventListener("DOMContentLoaded", function () {
            fetch('/proximo_codigo_plano')
                .then(response => response.json())
                .then(data => {
                    if (data.proximo_codigo) {
                        document.getElementById('codigo').value = data.proximo_codigo;
                    } else {
                        console.warn("Código de plano não retornado pela API.");
                    }
                })
                .catch(error => {
                    console.error("Erro ao buscar código de plano:", error);
                });
        });
</script>
       
    
    
